<?php
$this->headTitle('View Post - ' . $post->getTitle());
$this->mainMenu()->setActiveItemId('posts');
$this->pageBreadcrumbs()->setItems([
            'Home'=>$this->url('home'),
            'Posts'=>$this->url('posts'),
            'View Post'=>''
            ]);
?>

<a href="
    <?= $this->url('blog', ['action'=>'index']); ?>">
    &lt;&lt; Back to list of posts
</a>

<h1>
    <?= $this->escapeHtml($post->getTitle()); ?>    
</h1>

<p class="responses-header">
    <?= $this->escapeHtml($postManager->getResponseCountStr($post)); ?> | 
    <a href="<?= $this->url('posts', ['action'=>'add'], ['query' => 
                    ['id' => $post->getId()]]); ?>">
        Add new response
    </a>
</p>

<?php
$parentPosts = $post->getParentPosts();
foreach ($parentPosts as $parent):
    ?>
    <p>Response to:<a href="<?= $this->url('posts', ['action' => 'view', 'id' => $parent->getId()]); ?>">
            <?= $this->escapeHtml($parent->getTitle()); ?>
        </a>   
    </p>
<?php endforeach; 
if(count($parentPosts)<1)
    echo '<p>Response to: None';
?>

<p>
    Published: <?= $this->escapeHtml(date('jS \of F Y', strtotime($post->getDateCreated()))); ?> 
    | Tags: <?= $this->escapeHtml($postManager->convertTagsToString($post)); ?>   
</p>

<p>    
    <?= $this->escapeHtml($post->getContent()); ?>
</p>

<hr/>

<?php if(count($files)==0): ?>

<p>
  <i>There are no images to display.</i>
</p>

<?php else: ?>

<div class="row">
  <div class="col-sm-6 col-md-12">

    <?php foreach($files as $file): ?>  
        <a target="_blank" href="<?= $this->url('images', ['action' => 'file'], 
        ['query' => ['name' => $file, 'id' => $post->getId(), 
        'loc' => 'perm']]); ?>" class="btn btn-default" role="button"> 
            
            <img src="<?= $this->url('images', ['action' => 'file'], ['query' => 
            ['name' => $file, 'id' => $post->getId(), 'loc' => 'perm', 
            'thumbnail' => true]]); ?>">
            
        </a>
    <?php endforeach; ?>
  </div>
</div>

<?php endif; ?>

<hr/>

<a name="response"></a>
    

<div class="row">
    <div class="col-md-8">
    <p>
    <a class="btn btn-default" href="
        <?= $this->url('posts', ['action'=>'add'], ['query' => 
                    ['id' => $post->getId()]]); ?>">
        Leave Response
    </a>
    </p>
    </div>
</div> 


<h3><?= $this->escapeHtml($postManager->getResponseCountStr($post)); ?></h3>



    <?php foreach($posts as $childPost): ?>
        
    <h3>
        <a href="<?= $this->url('posts', ['action'=>'view', 'id'=>$childPost->getId()]); ?>">
            <?= $this->escapeHtml($childPost->getTitle()); ?>
        </a>    
    </h3>
    
    <p>
        Published: <?= $this->escapeHtml(date('jS \of F Y', strtotime($childPost->getDateCreated()))); ?> 
        | Tags: <?= $this->escapeHtml($postManager->convertTagsToString($childPost)); ?>   
    </p>    
        
    <p class="responses-header">
        <?= $this->escapeHtml($postManager->getResponseCountStr($childPost)); ?> | 
        <a href="<?= $this->url('posts', ['action'=>'view', 'id'=>$childPost->getId()],
                ['fragment'=>'response']); ?>">
            Add new response
        </a>
    </p>

    <p>    
        <?= $this->escapeHtml($childPost->getContent()); ?>
    </p>
    
    <?php 
    $childFiles = $imageManager->getFirstSavedFiles($childPost->getId());
    ?>
    
    <hr/>

    <?php if(count($childFiles)==0): ?>

    <p>
      <i>There are no images to display.</i>
    </p>

    <?php else: ?>

    <div class="row">
      <div class="col-sm-6 col-md-12">

        <?php foreach($childFiles as $childFile): ?>  
            <a target="_blank" href="<?= $this->url('images', ['action' => 'file'], 
            ['query' => ['name' => $childFile, 'id' => $childPost->getId(), 
            'loc' => 'perm']]); ?>" class="btn btn-default" role="button"> 

                <img src="<?= $this->url('images', ['action' => 'file'], ['query' => 
                ['name' => $childFile, 'id' => $childPost->getId(), 'loc' => 'perm', 
                'thumbnail' => true]]); ?>">

            </a>
        <?php endforeach; ?>
      </div>
    </div>

    <?php endif; ?>

    <hr/>

    <?php endforeach; ?>

    <?= $this->paginationControl($posts,
                    'Sliding',
                    'application/partial/paginator', 
                    array('route' => 'blog')); ?>
   